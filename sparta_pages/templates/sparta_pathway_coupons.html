{% extends "sparta_base.html" %}
{% load static %}

{% block title %}Coursebank | SPARTA | Your Enrollment Codes{% endblock %}

{% block sparta_body %}

<div class="card">
  <div class="card-body">
    <h2 class="card-title">Your Learning Pathways</h2>

    <p>To enroll and take Sparta courses for free, you must apply for Pathways and get enrollment access to their corresponding courses. Once you apply and get accepted for a Pathway, you will receive an email with instructions on how to access the courses of the Pathway you applied for.</p>
    <p><a target="blank" href="{% url 'sparta-main' %}">(Click here for details about Sparta Pathways)</a></p>

    <table class="table">
      <thead class="thead-light">
        <tr>
          <th>Pathway</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% if pathway_applications %}
        {% for app in pathway_applications %}
        <tr>
          <td>{{ app.pathway }}</td>
          <td>{{ app.get_status_display }}</td>
          {% if app.status == 'AP' %}
          <td>
            <div class="dropdown show">
              <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink{{app.pathway.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuLink{{app.pathway.id}}">
                <a class="dropdown-item" href="{% url 'sparta-pathway-progress' pathway_id=app.pathway.id %}">View Progress</a>
                <a class="dropdown-item" href="{% url 'sparta-pathway-coupons' pathway_id=app.pathway.id %}">Enrollment Codes</a>
              </div>
            </div>
          </td>
          {% elif app.status == 'DE' %}
          <td>-</td>
          {% else %}
          <td><div type="div" class="btn btn-outline-secondary" style="cursor: pointer" data-toggle="modal" data-target="#withdrawModal">Withdraw</div></td>
          <!-- Modal Block -->
          <div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="withdrawModalLabel">Withdraw Application</h5>
                  <div type="div" class="close" style="cursor: pointer" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </div>
                </div>
                <div class="modal-body">
                  Are you sure you want to withdraw your application for this Learning Pathway ({{ app.pathway }})?
                </div>
                <div class="modal-footer">
                  <form action="{% url 'sparta-withdraw' id=app.id %}" method="POST">
                    {% csrf_token %}
                    <div type="div" class="btn btn-secondary" data-dismiss="modal">Cancel</div>
                    <input class="btn btn-primary" id="submit" type="submit" value="Yes, Withdraw My Application" />
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
        {% endif %}
      </tbody>
    </table>

    {% if not max_applied %}
      <a class="btn btn-primary" href="{% url 'sparta-application-page' %}">Apply for a pathway</a>
    {% endif %}

    <h2 class="card-title">Your Enrollment Codes for the {{ pathway.name|title }} Learning Pathway</h2>

    {% if coupons %}
    <div class="p">
      Use these enrollment codes to enroll and get verified access to the Learning Pathway courses for free. <a href="/coupon" target="_blank">Learn how to use enrollment codes here</a>.
    </div>
    <div class="p">
      Please <b>do not</b> share these codes with other learners. Each code can only be used once for their corresponding course and cannot be used again once redeemed for enrollment.
    </div>
    {% else %}
    <div class="p">
      There are currently no coupons available for this Learning Pathway. If you've been approved for this Learning Pathway, please wait while we process your enrollments. We'll let you know once the coupons are available via email. In the meantime, you may continue taking the courses for free in audit mode.
    </div>
    {% endif %}

    <table class="table table-hover">
      <thead class="thead-light">
        <tr>
          <th>Course</th>
          <th>Coupon Code</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% if coupons %}
        {% for coupon in coupons %}
        <tr>
          <td>{{ coupon.courseoverview.display_name }}</td>
          <td>{{ coupon.coupon_code }}</td>
          <td>
            <a class="btn btn-primary" target="_blank" href="{% url 'about_course' course_id=coupon.courseoverview.id %}">
              View Course
            </a>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
        {% endif %}
      </tbody>
    </table>

  </div>
</div>

{% endblock %}