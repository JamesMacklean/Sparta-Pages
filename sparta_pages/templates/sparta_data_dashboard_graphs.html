{% extends "sparta_base.html" %}
{% load static %}

{% block title %}Coursebank | SPARTA | Data Dashboard{% endblock %}

{% block sparta_body %}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">

  google.charts.load('current', {'packages':['corechart']});

  google.charts.setOnLoadCallback(drawEnrolleesByClassChart);
  google.charts.setOnLoadCallback(drawEnrolleesByAgeChart);
  google.charts.setOnLoadCallback(drawEnrolleesByGenderChart);
  google.charts.setOnLoadCallback(drawEnrolleesByLocationChart);
  google.charts.setOnLoadCallback(drawEnrolleesStatusChart);
  google.charts.setOnLoadCallback(drawEnrolleesTypeChart);
  google.charts.setOnLoadCallback(drawEnrolleesByDateChart);

  function drawEnrolleesByClassChart() {

    var data = new google.visualization.arrayToDataTable([
      ['Class', 'Count'],
      ['Student', {{ no_of_enrollees_by_class.student }}],
      ['Faculty', {{ no_of_enrollees_by_class.faculty }}],
      ['Private', {{ no_of_enrollees_by_class.private }}],
      ['Government', {{ no_of_enrollees_by_class.government }}]
    ]);

    var options = {title:'Number of Enrollees by Class',
                   'width':900,
                   'height':550
                  };

    var chart = new google.visualization.ColumnChart(document.getElementById('Enrollees_by_class_div'));
    chart.draw(data, options);
  }

  function drawEnrolleesByAgeChart() {

    var data = new google.visualization.arrayToDataTable([
      ['Age', 'Count'],
      {% for student in no_of_enrollees_by_age %}
      ["{{ student.age }}", {{ student.count }}],
      {% endfor %}
    ]);

    var options = {title:'Number of Enrollees by Age',
                   'width':900,
                   'height':550
                  };

    var chart = new google.visualization.ColumnChart(document.getElementById('Enrollees_by_age_div'));
    chart.draw(data, options);
  }

  function drawEnrolleesByGenderChart() {

    var data = new google.visualization.arrayToDataTable([
      ['Gender', 'Count'],
      ['Male', {{ no_of_enrollees_by_gender.male }}],
      ['Female', {{ no_of_enrollees_by_gender.female }}],
      ['Other', {{ no_of_enrollees_by_gender.other }}],
    ]);

    var options = {title:'Number of Enrollees by Gender',
                   'width':900,
                   'height':550
                  };

    var chart = new google.visualization.ColumnChart(document.getElementById('Enrollees_by_gender_div'));
    chart.draw(data, options);
  }

  function drawEnrolleesByLocationChart() {

    var data = new google.visualization.arrayToDataTable([
      ['Location', 'Count'],
      {% for student in no_of_enrollees_by_location %}
      ["{{ student.city }}", {{ student.count }}],
      {% endfor %}
    ]);

    var options = {title:'Number of Enrollees by Location',
                   'width':900,
                   'height':550
                  };

    var chart = new google.visualization.ColumnChart(document.getElementById('Enrollees_by_location_div'));
    chart.draw(data, options);
  }

  function drawEnrolleesStatusChart() {

    {% for course in courses %}
    var data = new google.visualization.arrayToDataTable([
      ['Status', 'Count'],
      ["Completed", {{ course.no_of_completed }}],
      ["Unfinished", {{ course.no_of_unfinished }}],
    ]);

    var options_{{ course.slug }} = {'title':'Enrollees Status per Course',
                   'width':900,
                   'height':550
                  };

    var chart_{{ course.slug }} = new google.visualization.PieChart(document.getElementById('Enrollees_status_chart_div'));
    chart_{{ course.slug }}.draw(data_{{ course.slug }}, options_{{ course.slug }});
    {% endfor %}
  }


  function drawEnrolleesTypeChart() {

    {% for course in courses %}
    var data_{{ course.slug }} = new google.visualization.arrayToDataTable([
      ['Type', 'Count'],
      ['Audit', {{ course.no_of_audit_enrollees }}],
      ['Honor', {{ course.no_of_honor_enrollees }}],
      ['Verified', {{ course.no_of_verified_enrollees }}],
    ]);

    var options_{{ course.slug }} = {'title':'Enrollees Type per Course',
                  'width':900,
                  'height':550
                  };

    var chart_{{ course.slug }} = new google.visualization.PieChart(document.getElementById('Enrollees_type_chart_div_{{ course.slug }}'));
    chart_{{ course.slug }}.draw(data_{{ course.slug }}, options_{{ course.slug }});
    {% endfor %}
  }

  function drawEnrolleesByDateChart() {

    var data = new google.visualization.arrayToDataTable([
      ['Date', 'Count'],
      {% for student in no_of_enrollees_by_date %}
      ["{{ student.date }}", {{ student.count }}],
      {% endfor %}
    ]);

    var options = {title:'Number of Enrollees by Date',
                   'width':900,
                   'height':550
                  };

    var chart = new google.visualization.ColumnChart(document.getElementById('Enrollees_by_date_div'));
    chart.draw(data, options);
  }

  $(document).ready(function(){
    $("select").change(function(){
        $(this).find("option:selected").each(function(){
            var optionValue = $(this).attr("value");
            if(optionValue){
                $(".sparta").not("." + optionValue).hide();
                $("." + optionValue).show();
            } else{
                $(".sparta").hide();
            }
        });
    }).change();
  });

</script>

<a href="{% url 'sparta-data-dashboard-main' %}" class="btn btn-link">&#171; Back to Dashboard</a>

<br>
<div class="d-flex flex-column">

  <div class="p-2 flex-fill justify-content-center">
    <h3>Number of Enrollees by Class</h3>
    <div id="Enrollees_by_class_div"></div>
  </div>

  <div class="p-2 flex-fill justify-content-center">
    <h3>Number of Enrollees by Age</h3>
    <div id="Enrollees_by_age_div"></div>
  </div>

  <div class="p-2 flex-fill justify-content-center">
    <h3>Number of Enrollees by Gender</h3>
    <div id="Enrollees_by_gender_div"></div>
  </div>

  <div class="p-2 flex-fill justify-content-center">
    <h3>Number of Enrollees by Location</h3>
    <div id="Enrollees_by_location_div"></div>
  </div>

  <div class="p-2 flex-fill justify-content-center">
    <h3>Number of Enrollees by Date</h3>
    <div id="Enrollees_by_date_div"></div>
  </div>

  <div class="p-2 flex-fill justify-content-center" style="padding:20px;">
    <h3>Number of Enrollees by Course</h3>
    <select>
      {% for course in courses %}
      <option value="{{ course.course_id }}">{{ course.name }}</option>
      {% endfor %}
    </select>

    {% for course in courses %}
    <div class="p-2 flex-fill justify-content-center sparta sparta {{ course.course_id }}">
      <h3>Course: {{ course.name }}</h3>
      <h3>Course ID: {{ course.course_id }}</h3>
      <h4>Total Number of Enrollees: {{ course.total_no_of_enrollees }}</h4>
      <div id="Enrollees_type_chart_div_{{ course.slug }}"></div>
      <div id="Enrollees_status_chart_div_{{ course.slug }}"></div>
    </div>
    {% endfor %}

  </div>

{% endblock %}

{% block sparta_extra_script %}
<script>
$(document).ready(function(){
    $("select").change(function(){
        $(this).find("option:selected").each(function(){
            var optionValue = $(this).attr("value");
            if(optionValue){
                $(".sparta").not("." + optionValue).hide();
                $("." + optionValue).show();
            } else{
                $(".sparta").hide();
            }
        });
    }).change();

    console.log("no_of_enrollees_by_class: " + {{ no_of_enrollees_by_class }});
    console.log("no_of_enrollees_by_age: " + {{ no_of_enrollees_by_age }});
    console.log("no_of_enrollees_by_gender: " + {{ no_of_enrollees_by_gender }});
    console.log("no_of_enrollees_by_location: " + {{ no_of_enrollees_by_location }});
    console.log("no_of_enrollees_by_date: " + {{ no_of_enrollees_by_date }});
    console.log("courses: " + {{ courses }});
});
</script>
{% endblock %}
